# 生产进度看板

### 1、生产统计分析图表

```sql
sql语句
SELECT CONVERT(DECIMAL(18,0), OkQty)	OkQty ,
       CONVERT(DECIMAL(18, 0), TotalQty)	TotalQty,
       CONVERT(DECIMAL(18, 2), OkQty*100/IIF(TotalQty=0, 1, TotalQty)) AS OkRate,
	   RIGHT(OpDate,5)	OpDate
FROM 
    (SELECT TOP 3 SUM(F_OkQty)	OkQty,
        SUM(F_OkQty+F_NgQty)	TotalQty,
        CONVERT(VARCHAR(100), F_CreatorTime, 111)   OpDate
    FROM mes_report_detail
    WHERE DATEDIFF(DAY,F_CreatorTime,GETDATE())<=14  AND DATEDIFF(day,F_CreatorTime,GETDATE())>= 0 AND (F_OkQty+F_NgQty)>0  
    GROUP BY  CONVERT(VARCHAR(100), F_CreatorTime, 111)  
    ORDER BY  OpDate DESC) a
ORDER BY OpDate

响应数据

[
    {
        "OkQty": 18000,
        "TotalQty": 18110,
        "OkRate": 99.39,
        "OpDate": "12/07"
    },
    {
        "OkQty": 36160,
        "TotalQty": 36470,
        "OkRate": 99.15,
        "OpDate": "12/08"
    },
    {
        "OkQty": 16500,
        "TotalQty": 16620,
        "OkRate": 99.28,
        "OpDate": "12/09"
    }
]

```

### 2、原料消耗统计图表

```sql
sql语句
SELECT Convert(decimal(18,0), oknumb)oknumb ,
       Convert(decimal(18, 0), total)total,
       Convert(decimal(18, 2), oknumb*100/total) AS ratess,right( dayss,5)dayss
FROM 
    (SELECT top 6 sum(F_OkQty) oknumb,
        sum(F_OkQty+F_NgQty)total,
        CONVERT(varchar(100), F_CreatorTime, 111)   dayss
    FROM mes_report_detail
    WHERE datediff(day,F_CreatorTime,getdate())<=14  and datediff(day,F_CreatorTime,getdate())>= 0 and (F_OkQty+F_NgQty)>0  
    GROUP BY  CONVERT(varchar(100), F_CreatorTime, 111)  
    ORDER BY  dayss desc) a
ORDER BY  dayss

响应数据

[
    {
        "oknumb": 24400,
        "total": 24760,
        "ratess": 98.55,
        "dayss": "12/02"
    },
    {
        "oknumb": 22670,
        "total": 22930,
        "ratess": 98.87,
        "dayss": "12/03"
    },
    {
        "oknumb": 47800,
        "total": 48180,
        "ratess": 99.21,
        "dayss": "12/04"
    },
    {
        "oknumb": 18000,
        "total": 18110,
        "ratess": 99.39,
        "dayss": "12/07"
    },
    {
        "oknumb": 36160,
        "total": 36470,
        "ratess": 99.15,
        "dayss": "12/08"
    },
    {
        "oknumb": 16500,
        "total": 16620,
        "ratess": 99.28,
        "dayss": "12/09"
    }
]
```

### 3、月合格率

```sql
sql语句
select convert(decimal(18,0),round(sum(F_OkQty)*100.00/IIF(sum(F_OkQty+F_NgQty)=0,1,sum(F_OkQty+F_NgQty)),0) ) value
 from mes_report_detail
where datediff(mm,F_CreatorTime,GETDATE())=0

响应数据
{
    "data": 99
}
```

### 4、日合格率

```sql
sql语句
select convert(decimal(18,0),round(ISNULL(sum(F_OkQty),0)*100.00/IIF(ISNULL(sum(F_OkQty+F_NgQty),0)=0,1,sum(F_OkQty+F_NgQty)),2) ) value
from mes_report_detail
where datediff(dd,F_CreatorTime,GETDATE())=0

响应数据
[
    {
        "value": 99
    }
]
```

### 5、完成计划

```sql
sql语句
select convert(nvarchar(10),convert(decimal(18,0),ISNULL(sum(F_OkQty+F_NgQty),0)))+'/'+convert(nvarchar(20),convert(decimal(18,0),ISNULL(sum(F_RequireAmount),0))) curValue
from base_workorder
where datediff(dd,F_CreatorTime,GETDATE())=0
响应数据
{
    "value": "0/0"
}
```

### 6、实时产能监控

```sql
sql语句
select aa.F_FullName value,ISNULL(bb.数量,0) name from base_organize aa
left join (
select b.F_WorkShopId,sum(a.F_OkQty+a.F_NgQty) 数量 from mes_report_detail a
left join base_workorder b on F_WoId=b.F_Id 
where datediff(mm,a.F_creatortime,getdate())=0
group by b.F_WorkShopId)bb on aa.F_Id =bb.F_WorkShopId
where aa.F_Id in (
'1081',
'1082',
'1083'
)

响应数据
{
    "xList": [
        0,
        0,
        180230
    ],
    "yList": [
        "包装车间",
        "杆盘车间",
        "注塑车间"
    ]
}
```

### 7、生产进度信息

```sql
sql语句
select  top 30 
a.F_WoNo 工单号
,a.F_PartNo 物料编号
,a.F_PartName 物料名称
,c.F_Specs 规格型号
,a.F_OkQty 合格数
,a.F_NgQty 不良数
,a.F_RequireAmount 需求数
,b.F_UnitName 单位
,convert(nvarchar,convert(decimal(18,2),round((F_OkQty+F_NgQty)*100/IIF(ISNULL(F_RequireAmount,0)=0,1,ISNULL(F_RequireAmount,0)),2)))+'%' 生产进度
,case when a.F_Status=0 then '创建' 
when  a.F_Status=1 then '已排程' 
when  a.F_Status=2 then '已下发' 
when  a.F_Status=3 then '生产中' 
when  a.F_Status=4 then '已完成' 
when  a.F_Status=5 then '强制结单' 
else '已取消' end 生产状态
from base_workorder a
left join base_unit b on a.F_Unit=b.F_Id
left join base_part c on a.F_partid=c.F_id
where a.F_CreatorTime>DATEDIFF(day,GETDATE(),-30)
order by F_RequireTime desc

响应数据
[
    {
        "工单号": "WO20250728028",
        "物料编号": "02.05.C.1903-01",
        "物料名称": "螺母22#细-黑色3#",
        "规格型号": "20*28",
        "合格数": 0,
        "不良数": 0,
        "需求数": 4840,
        "单位": "个",
        "生产进度": "0.00%",
        "生产状态": "已排程"
    },
    {
        "工单号": "WO20250728029",
        "物料编号": "02.05.C.1906-01",
        "物料名称": "360中节-卡其色7401",
        "规格型号": "2.6*4.7",
        "合格数": 0,
        "不良数": 0,
        "需求数": 1680,
        "单位": "个",
        "生产进度": "0.00%",
        "生产状态": "已排程"
    },
    {
        "工单号": "WO20250314012",
        "物料编号": "02.02.A.F09.0375-05",
        "物料名称": "5代手柄头(包胶用)-425C灰",
        "规格型号": "",
        "合格数": 0,
        "不良数": 0,
        "需求数": 44,
        "单位": "个",
        "生产进度": "0.00%",
        "生产状态": "已排程"
    },
    {
        "工单号": "WO20250307014",
        "物料编号": "02.05.C.1901-01",
        "物料名称": "5代免手洗螺丝卡扣-薄款",
        "规格型号": "10*4",
        "合格数": 500,
        "不良数": 30,
        "需求数": 467,
        "单位": "个",
        "生产进度": "113.49%",
        "生产状态": "已完成"
    },
    {
        "工单号": "WO20251111011",
        "物料编号": "02.05.C.1902-01",
        "物料名称": "螺母22#粗-本色黑色",
        "规格型号": "",
        "合格数": 600,
        "不良数": 20,
        "需求数": 500,
        "单位": "个",
        "生产进度": "124.00%",
        "生产状态": "已完成"
    },
    {
        "工单号": "WO20251111017",
        "物料编号": "02.05.C.1903-02",
        "物料名称": "螺纹头22#细-黑色3#",
        "规格型号": "1.9*4.1",
        "合格数": 500,
        "不良数": 30,
        "需求数": 346,
        "单位": "个",
        "生产进度": "153.18%",
        "生产状态": "已完成"
    },
    {
        "工单号": "WO20251127023",
        "物料编号": "02.05.A.0393-04",
        "物料名称": "370手柄-浅灰7225",
        "规格型号": "",
        "合格数": 0,
        "不良数": 0,
        "需求数": 500,
        "单位": "个",
        "生产进度": "0.00%",
        "生产状态": "已下发"
    },
    {
        "工单号": "WO20251127016",
        "物料编号": "02.01.A.A3.0111-01",
        "物料名称": "小杆开关-灰色7423(内销浅灰)",
        "规格型号": "8.9*2.5*3.6",
        "合格数": 600,
        "不良数": 10,
        "需求数": 500,
        "单位": "个",
        "生产进度": "122.00%",
        "生产状态": "已完成"
    },
    {
        "工单号": "WO20251127017",
        "物料编号": "02.01.C.0321-07",
        "物料名称": "小杆小扳扣-白色7598",
        "规格型号": "5.3*2.2*1.3",
        "合格数": 600,
        "不良数": 10,
        "需求数": 500,
        "单位": "个",
        "生产进度": "122.00%",
        "生产状态": "已完成"
    },
    {
        "工单号": "WO20251127018",
        "物料编号": "02.01.C.0321-06",
        "物料名称": "小杆堵套-白色",
        "规格型号": "4.1*2.2",
        "合格数": 620,
        "不良数": 10,
        "需求数": 500,
        "单位": "个",
        "生产进度": "126.00%",
        "生产状态": "已完成"
    },
    {
        "工单号": "WO20251127019",
        "物料编号": "02.05.C.1903-01",
        "物料名称": "螺母22#细-黑色3#",
        "规格型号": "20*28",
        "合格数": 650,
        "不良数": 20,
        "需求数": 500,
        "单位": "个",
        "生产进度": "134.00%",
        "生产状态": "已完成"
    },
    {
        "工单号": "WO20251111019",
        "物料编号": "02.01.A.A3.0103-05",
        "物料名称": "连接头(金属抗菌盘)-浅灰7423",
        "规格型号": "",
        "合格数": 0,
        "不良数": 0,
        "需求数": 70,
        "单位": "个",
        "生产进度": "0.00%",
        "生产状态": "已下发"
    },
    {
        "工单号": "WO20251104003",
        "物料编号": "02.04.B.WB01.1662-11",
        "物料名称": "簸箕2(装箱)-浅灰色M159(妙洁)自产",
        "规格型号": "26*25*9",
        "合格数": 0,
        "不良数": 0,
        "需求数": 34419,
        "单位": "个",
        "生产进度": "0.00%",
        "生产状态": "已排程"
    },
    {
        "工单号": "WO20251104010",
        "物料编号": "02.02.B.F11.0601-01",
        "物料名称": "360组件-主架(大芯)小米白7044+内支架7043",
        "规格型号": "12*5.5*53",
        "合格数": 2500,
        "不良数": 30,
        "需求数": 2006,
        "单位": "个",
        "生产进度": "126.12%",
        "生产状态": "已完成"
    },
    {
        "工单号": "WO20251127024",
        "物料编号": "02.01.C.0321-04",
        "物料名称": "螺纹头22#粗-麻花杆-本色",
        "规格型号": "",
        "合格数": 600,
        "不良数": 20,
        "需求数": 500,
        "单位": "个",
        "生产进度": "124.00%",
        "生产状态": "已完成"
    },
    {
        "工单号": "WO20251127021",
        "物料编号": "02.02.B.F06.0502-31",
        "物料名称": "刮刮乐面板(衬板)(带本色万向头2)-白色7409",
        "规格型号": "31.8*11*2.8+28*26*10",
        "合格数": 0,
        "不良数": 0,
        "需求数": 2800,
        "单位": "个",
        "生产进度": "0.00%",
        "生产状态": "已下发"
    },
    {
        "工单号": "WO20251127038",
        "物料编号": "02.02.C.T.0982-01",
        "物料名称": "5代锁舌-本色",
        "规格型号": "26*11*7",
        "合格数": 17200,
        "不良数": 160,
        "需求数": 15257,
        "单位": "个",
        "生产进度": "113.78%",
        "生产状态": "已完成"
    },
    {
        "工单号": "WO20251111025",
        "物料编号": "02.01.A.A3.0083-01",
        "物料名称": "(现场)组件-迷你桶浅灰7225+提手灰色7229+水塞白色+轴套",
        "规格型号": "45.8*25.2*22.5",
        "合格数": 2500,
        "不良数": 30,
        "需求数": 2400,
        "单位": "个",
        "生产进度": "105.42%",
        "生产状态": "已完成"
    },
    {
        "工单号": "WO20251111026",
        "物料编号": "02.01.A.A3.0083-02",
        "物料名称": "迷你桶挡水板-灰色7229",
        "规格型号": "",
        "合格数": 2600,
        "不良数": 30,
        "需求数": 2400,
        "单位": "个",
        "生产进度": "109.58%",
        "生产状态": "已完成"
    },
    {
        "工单号": "WO20251127004",
        "物料编号": "02.04.A.X.1491-05",
        "物料名称": "扫把中节-妙洁灰色M159",
        "规格型号": "5*2.4",
        "合格数": 0,
        "不良数": 0,
        "需求数": 98062,
        "单位": "个",
        "生产进度": "0.00%",
        "生产状态": "已下发"
    },
    {
        "工单号": "WO20251127005",
        "物料编号": "02.04.A.X.1492-01",
        "物料名称": "螺纹头19#黑色3#-扫把",
        "规格型号": "",
        "合格数": 50100,
        "不良数": 370,
        "需求数": 49031,
        "单位": "个",
        "生产进度": "102.93%",
        "生产状态": "已完成"
    },
    {
        "工单号": "WO20251127006",
        "物料编号": "02.04.A.WB01.1421-06",
        "物料名称": "扫把主体盖-妙洁灰色M159",
        "规格型号": "",
        "合格数": 0,
        "不良数": 0,
        "需求数": 28231,
        "单位": "个",
        "生产进度": "0.00%",
        "生产状态": "已下发"
    },
    {
        "工单号": "WO20251127007",
        "物料编号": "02.04.A.X.1491-06",
        "物料名称": "扫把手柄-妙洁灰色M159",
        "规格型号": "11.8*2.5",
        "合格数": 0,
        "不良数": 0,
        "需求数": 6031,
        "单位": "个",
        "生产进度": "0.00%",
        "生产状态": "已下发"
    },
    {
        "工单号": "WO20251127008",
        "物料编号": "02.04.B.WB01.1662-02",
        "物料名称": "簸箕手柄2-浅灰色M159(妙洁)",
        "规格型号": "",
        "合格数": 0,
        "不良数": 0,
        "需求数": 90507,
        "单位": "个",
        "生产进度": "0.00%",
        "生产状态": "已下发"
    },
    {
        "工单号": "WO20251127009",
        "物料编号": "02.04.B.WB01.1662-11",
        "物料名称": "簸箕2(装箱)-浅灰色M159(妙洁)自产",
        "规格型号": "26*25*9",
        "合格数": 0,
        "不良数": 0,
        "需求数": 75787,
        "单位": "个",
        "生产进度": "0.00%",
        "生产状态": "已下发"
    },
    {
        "工单号": "WO20251127040",
        "物料编号": "02.05.C.1902-01",
        "物料名称": "螺母22#粗-本色黑色",
        "规格型号": "",
        "合格数": 32400,
        "不良数": 290,
        "需求数": 29499,
        "单位": "个",
        "生产进度": "110.82%",
        "生产状态": "已完成"
    },
    {
        "工单号": "WO20251127033",
        "物料编号": "02.02.B.PD07.0672-08",
        "物料名称": "组件PD07刮刮乐-面板小米暖白7942+万向头2红M258+底板灰色214",
        "规格型号": "320*110*23",
        "合格数": 0,
        "不良数": 0,
        "需求数": 19642,
        "单位": "个",
        "生产进度": "0.00%",
        "生产状态": "已下发"
    },
    {
        "工单号": "WO20251127034",
        "物料编号": "02.02.B.PD07.0672-09",
        "物料名称": "PD07刮刮乐(新模)-关节-小米暖白7989",
        "规格型号": "117*27*22",
        "合格数": 0,
        "不良数": 0,
        "需求数": 19642,
        "单位": "个",
        "生产进度": "0.00%",
        "生产状态": "已下发"
    },
    {
        "工单号": "WO20251127015",
        "物料编号": "02.04.B.D10.1511-02",
        "物料名称": "组件-马桶刷上手柄白7044+盖子灰7040",
        "规格型号": "2.3*2.3*20.5+2.5*2.5",
        "合格数": 12500,
        "不良数": 150,
        "需求数": 12000,
        "单位": "个",
        "生产进度": "105.42%",
        "生产状态": "已完成"
    },
    {
        "工单号": "WO20251127010",
        "物料编号": "02.03.B.PM33.1135-03",
        "物料名称": "小号四面挤水-装饰件-蓝色1172(色粉)",
        "规格型号": "98*14*6",
        "合格数": 0,
        "不良数": 0,
        "需求数": 19300,
        "单位": "个",
        "生产进度": "0.00%",
        "生产状态": "已下发"
    }
]
```

8、点检未完成项

```sql
sql语句

select F_EquipName 
,count(1) b from
eq_check_record where F_Status=0
group by F_EquipName

响应数据

[
    {
        "F_EquipName": "21号注塑机(570)",
        "b": 175
    },
    {
        "F_EquipName": "26号注塑机(370)",
        "b": 175
    },
    {
        "F_EquipName": "14号注塑机(540)",
        "b": 170
    },
    {
        "F_EquipName": "34号注塑机(2250)",
        "b": 175
    }
]
```

# 综合看板

### 1、订单情况

```sql
sql语句

SELECT Convert(decimal(18,0), oknumb)oknumb ,
       Convert(decimal(18, 0), total)total,
       Convert(decimal(18, 2), oknumb*100/total) AS ratess,right( dayss,5)dayss
FROM 
    (SELECT top 6 sum(F_OkQty) oknumb,
        sum(F_OkQty+F_NgQty)total,
        CONVERT(varchar(100), F_CreatorTime, 111)   dayss
    FROM mes_report_detail
    WHERE datediff(day,F_CreatorTime,getdate())<=14  and datediff(day,F_CreatorTime,getdate())>= 0 and (F_OkQty+F_NgQty)>0  
    GROUP BY  CONVERT(varchar(100), F_CreatorTime, 111)  
    ORDER BY  dayss desc) a
ORDER BY  dayss

响应数据

[
    {
        "oknumb": 24400,
        "total": 24760,
        "ratess": 98.55,
        "dayss": "12/02"
    },
    {
        "oknumb": 22670,
        "total": 22930,
        "ratess": 98.87,
        "dayss": "12/03"
    }
]
```

### 2、设备情况

```sql
sql语句

select onoffrate,oee,right(dayss,5)dayss1 from (
select top 6 F_EqOnOffRate onoffrate, F_Efficienc oee,  CONVERT(NVARCHAR(50),F_EqRunDate,111)  dayss  
from base_equip_runinfo
 where  datediff(day,F_EqRunDate,getdate())<=30  and  datediff(day,F_EqRunDate,getdate())>0
order by dayss desc
)aa 
order by dayss

响应数据
[
    {
        "onoffrate": 86.9,
        "oee": 80.4,
        "dayss1": "12/03"
    },
    {
        "onoffrate": 87.4,
        "oee": 80.8,
        "dayss1": "12/04"
    }
]

```

### 3、注塑日产量

```sql
sql语句

	select  right(dayss,5) dayss,numb from (
	select top 6 convert(nvarchar(10), F_RecordDate,120) dayss,sum(F_HadDone) numb  from eq_yield_day
	WHERE datediff(day,F_RecordDate,getdate())<=14  and datediff(day,F_RecordDate,getdate())>= 0 and F_HadDone>0 
	and F_EquipName like '%注塑%'
	group by convert(nvarchar(10), F_RecordDate,120)
	order by convert(nvarchar(10), F_RecordDate,120) desc
	)aa
	order by dayss
	
响应数据

[
    {
        "dayss": "12-04",
        "numb": 54332
    },
    {
        "dayss": "12-05",
        "numb": 41236
    }
]
```

### 4、当月注塑机产量

```sql
sql语句

select * from (
select top 5 right(F_EquipCode,2)+'#'equip,sum(F_HadDone) haddone from eq_yield_day
where F_EquipName like '%注塑%' and convert(nvarchar(7),F_RecordDate,120) =convert(nvarchar(7),GETDATE(),120) 
group by F_EquipCode,	F_EquipId
order by sum(F_HadDone) desc
)a 
order by equip

响应数据

[
    {
        "equip": "19#",
        "haddone": 26633
    },
    {
        "equip": "23#",
        "haddone": 17942
    }
]
```

### 5、设备故障明细

```sql
sql语句

SELECT TOP 3 F_TagDesc AS ErrorMsg,F_UploadTime AS UpTime FROM eq_tagsetting WHERE F_TagDesc LIKE '系统%' AND F_Result='1' ORDER BY F_UploadTime DESC

响应数据
[
    {
        "ErrorMsg": "系统一17号站缺料",
        "UpTime": "2025-01-15 09:04:25"
    },
    {
        "ErrorMsg": "系统二12号站缺料",
        "UpTime": "2025-01-14 10:56:00"
    }
]
```

### 6、产品入库分析

```sql
sql语句

SELECT OpDate name,FinishInQty value FROM #InWarehouseInfo order by OpDate
DROP TABLE #InWarehouseInfo

响应数据
[
    {
        "name": "12/03",
        "value": 218800
    },
    {
        "name": "12/04",
        "value": 186400
    }
]


```

### 7、设备运行情况

```sql
sql语句

DECLARE @RunNum			INT
DECLARE @OpenNum		INT
DECLARE @WarnNum		INT
DECLARE @CloseNum		INT
DECLARE @TotalNum		INT
SELECT @RunNum=COUNT(F_Id) from base_equip where F_Status='1'  AND F_WorkshopId='1081' AND F_IsVirtual!=2 --运行
SELECT @OpenNum=COUNT(F_Id) from base_equip where F_Status='0'  AND F_WorkshopId='1081' AND F_IsVirtual!=2 --待机
SELECT @WarnNum=COUNT(F_Id) from base_equip where F_Status='-1'  AND F_WorkshopId='1081' AND F_IsVirtual!=2 --报警
SELECT @CloseNum=COUNT(F_Id) from base_equip where F_Status='9'  AND F_WorkshopId='1081' AND F_IsVirtual!=2 --关机
SELECT @TotalNum=COUNT(F_Id) from base_equip where  F_WorkshopId='1081' AND F_IsVirtual!=2 --总数
SELECT @RunNum AS RunNum,@OpenNum AS OpenNum,@WarnNum AS WarnNum,@CloseNum AS CloseNum,@TotalNum AS TotalNum

响应数据
[
    {
        "RunNum": 37,
        "OpenNum": 7,
        "WarnNum": 0,
        "CloseNum": 5,
        "TotalNum": 52
    }
]
```

### 8、设备信息表

```sql
sql语句

SELECT *,
	(SELECT F_EquipCode FROM base_equip WHERE F_Id=F_EquipId) AS EquipCode
FROM
(SELECT 
REPLACE(F_TagId, F_EquipId + '/','') AS ParamName,
F_Result AS CurValue,
F_EquipId
FROM eq_tagsetting
WHERE F_EquipId=(SELECT TOP 1 F_Id FROM base_equip WHERE
F_EquipCode LIKE 'A.01%' AND F_WorkshopId='1081' AND F_IsVirtual!=2 ORDER BY NEWID()))
AS SourceTable
PIVOT
(
	MAX(CurValue)
	FOR ParamName IN (Currentyield,lastCyclePeriod,recentUseRate)
) AS PivotTable

响应数据

```

### 9、计划生产工单

```sql
sql语句

SELECT TOP 3 ROW_NUMBER() OVER (ORDER BY (SELECT NULL)) AS RowNum, F_WoNo AS WoNo,'生产中' AS StrStatus FROM base_workorder WHERE F_Status=3 ORDER BY F_IssueTime DESC

响应数据

[
    {
        "RowNum": 1,
        "WoNo": "WO20241129004",
        "StrStatus": "生产中"
    },
    {
        "RowNum": 2,
        "WoNo": "WO20241128003",
        "StrStatus": "生产中"
    },
    {
        "RowNum": 3,
        "WoNo": "WO20241126003",
        "StrStatus": "生产中"
    }
]
```

### 10、热销机型排行

```sql
sql语句

SELECT TOP 4 a.F_PartNo AS PartNo,SUM(a.F_PlanQty) AS TotalQty FROM wms_warehouseout_detail a LEFT JOIN wms_warehouseout b ON a.F_WarehouseOutId=b.F_Id
 WHERE b.F_WarehouseType='SaleOut' GROUP BY F_PartNo ORDER BY TotalQty DESC
 
响应数据
 [
    {
        "PartNo": "02.01.C.Z-0321-05",
        "TotalQty": 600000
    },
    {
        "PartNo": "01.WM.PM32.D019-P",
        "TotalQty": 584932
    }
]
```

### 11、设备故障率

```sql
sql语句

DECLARE @WarnNum		INT
DECLARE @TotalNum		INT
DECLARE @WarnRate		DECIMAL(18,0)
SELECT @WarnNum=COUNT(F_Id) from base_equip where F_Status='-1'  AND F_WorkshopId='1081' AND F_IsVirtual!=2 --报警
SELECT @TotalNum=COUNT(F_Id) from base_equip where  F_WorkshopId='1081' AND F_IsVirtual!=2 --总数
SET @WarnRate=@WarnNum*100.00/IIF(@TotalNum=0, 1, @TotalNum)
SELECT CONVERT(VARCHAR, @WarnRate) +'%' AS WarnRate

响应数据

{
    "value": "0%"
}
```

### 12、设备开机率

```sql
sql语句

DECLARE @OpenNum		INT
DECLARE @TotalNum		INT
DECLARE @OpenRate		DECIMAL(18,0)
SELECT @OpenNum=COUNT(F_Id) from base_equip where (F_Status='0' OR F_Status='1') AND F_WorkshopId='1081' AND F_IsVirtual!=2 --待机+运行
SELECT @TotalNum=COUNT(F_Id) from base_equip where  F_WorkshopId='1081' AND F_IsVirtual!=2 --总数
SET @OpenRate=@OpenNum*100.00/IIF(@TotalNum=0, 1, @TotalNum)
SELECT CONVERT(VARCHAR, @OpenRate) +'%' AS OpenRate

响应数据

{
    "value": "85%"
}
```

