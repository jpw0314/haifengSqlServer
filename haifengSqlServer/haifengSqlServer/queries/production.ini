[production.stats_by_day]
# name=生产统计分析图表
wrap=none
columns=OkQty:decimal(18,0),TotalQty:decimal(18,0),OkRate:decimal(18,2),OpDate:varchar(5)
sql=SELECT CONVERT(DECIMAL(18,0), OkQty) AS OkQty, CONVERT(DECIMAL(18,0), TotalQty) AS TotalQty, CONVERT(DECIMAL(18,2), OkQty*100.0/NULLIF(TotalQty,0)) AS OkRate, RIGHT(OpDate,5) AS OpDate FROM (SELECT TOP 3 SUM(F_OkQty) AS OkQty, SUM(F_OkQty+F_NgQty) AS TotalQty, CONVERT(VARCHAR(100), F_CreatorTime, 111) AS OpDate FROM mes_report_detail WHERE F_CreatorTime >= DATEADD(DAY, -14, CAST(GETDATE() AS DATE)) AND F_CreatorTime < DATEADD(DAY, 1, CAST(GETDATE() AS DATE)) AND (F_OkQty+F_NgQty)>0 GROUP BY CONVERT(VARCHAR(100), F_CreatorTime, 111) ORDER BY OpDate DESC) a ORDER BY OpDate

[production.raw_material_consumption]
# name=原料消耗统计图表
wrap=none
columns=oknumb:decimal(18,0),total:decimal(18,0),ratess:decimal(18,2),dayss:varchar(5)
sql=SELECT CONVERT(DECIMAL(18,0), oknumb) AS oknumb, CONVERT(DECIMAL(18,0), total) AS total, CONVERT(DECIMAL(18,2), oknumb*100.0/NULLIF(total,0)) AS ratess, RIGHT(dayss,5) AS dayss FROM (SELECT TOP 6 SUM(F_OkQty) AS oknumb, SUM(F_OkQty+F_NgQty) AS total, CONVERT(VARCHAR(100), F_CreatorTime, 111) AS dayss FROM mes_report_detail WHERE F_CreatorTime >= DATEADD(DAY, -14, CAST(GETDATE() AS DATE)) AND F_CreatorTime < DATEADD(DAY, 1, CAST(GETDATE() AS DATE)) AND (F_OkQty+F_NgQty)>0 GROUP BY CONVERT(VARCHAR(100), F_CreatorTime, 111) ORDER BY dayss DESC) a ORDER BY dayss

[production.month_ok_rate]
# name=月合格率
wrap=none
columns=value:decimal(18,0)
sql=SELECT CONVERT(DECIMAL(18,0), ROUND(SUM(F_OkQty)*100.0/NULLIF(SUM(F_OkQty+F_NgQty),0),0)) AS value FROM mes_report_detail WHERE F_CreatorTime >= DATEADD(MONTH, DATEDIFF(MONTH, 0, GETDATE()), 0) AND F_CreatorTime < DATEADD(MONTH, DATEDIFF(MONTH, 0, GETDATE()) + 1, 0)

[production.day_ok_rate]
# name=日合格率
wrap=none
columns=value:decimal(18,0)
sql=SELECT CONVERT(DECIMAL(18,0), ROUND(ISNULL(SUM(F_OkQty),0)*100.0/NULLIF(ISNULL(SUM(F_OkQty+F_NgQty),0),0),2)) AS value FROM mes_report_detail WHERE F_CreatorTime >= CAST(GETDATE() AS DATE) AND F_CreatorTime < DATEADD(DAY, 1, CAST(GETDATE() AS DATE))

[production.unfinished_value]
# name=未完成值
wrap=none
columns=curValue:decimal(18,0)
sql=select convert(decimal(18,0),round(ISNULL(sum(F_RequireAmount-F_OkQty-F_NgQty),0),2) ) curValue from base_workorder where datediff(dd,F_CreatorTime,GETDATE())=0

[production.completion_rate]
# name=完成率
wrap=none
columns=curValue:decimal(18,0)
sql=select convert(decimal(18,0),round(ISNULL(sum(F_OkQty+F_NgQty),0)*100.00/IIF(ISNULL(sum(F_RequireAmount),0)=0,1,sum(F_RequireAmount)),2) ) curValue from base_workorder where datediff(dd,F_CreatorTime,GETDATE())=0

[production.plan_completion]
# name=完成/计划显示值
wrap=none
columns=value:varchar(50)
sql=SELECT CONVERT(NVARCHAR(10), CONVERT(DECIMAL(18,0), ISNULL(SUM(F_OkQty+F_NgQty),0))) + '/' + CONVERT(NVARCHAR(20), CONVERT(DECIMAL(18,0), ISNULL(SUM(F_RequireAmount),0))) value FROM base_workorder WHERE DATEDIFF(dd, F_CreatorTime, GETDATE())=0

[production.production_inbound_stats]
# name=生产入库信息统计
wrap=none
columns=产品型号:varchar(100),当月入库数:decimal(18,0),库存数:decimal(18,0)
sql=SELECT TOP 5 a.F_PartName 产品型号, SUM(F_Qty) 当月入库数, (SELECT SUM(F_AvailableQty) FROM wms_inventory WHERE F_PartId=a.F_PartId) 库存数 from wms_warehousein_scandetail a LEFT JOIN wms_warehousein b on a.F_WarehouseId=b.F_Id WHERE F_WarehouseType='ProduceIn' AND datediff(month, a.F_CreatorTime,GETDATE())=0 GROUP BY a.F_PartName,a.F_PartId

[production.capacity_monitor]
# name=实时产能监控
wrap=none
columns=value:varchar(100),name:int
sql=SELECT aa.F_FullName value, ISNULL(bb.数量,0) name FROM base_organize aa LEFT JOIN (SELECT b.F_WorkShopId, SUM(a.F_OkQty+a.F_NgQty) 数量 FROM mes_report_detail a LEFT JOIN base_workorder b ON F_WoId=b.F_Id WHERE DATEDIFF(mm, a.F_creatortime, GETDATE())=0 GROUP BY b.F_WorkShopId) bb ON aa.F_Id=bb.F_WorkShopId WHERE aa.F_Id IN ('1081','1082','1083')

[production.progress_info]
# name=生产进度信息
wrap=none
columns=工单号:varchar(50),物料编号:varchar(50),物料名称:varchar(100),规格型号:varchar(50),合格数:decimal(18,0),不良数:decimal(18,0),需求数:decimal(18,0),单位:varchar(10),生产进度:varchar(10),生产状态:varchar(10)
sql=SELECT TOP 30 a.F_WoNo 工单号, a.F_PartNo 物料编号, a.F_PartName 物料名称, c.F_Specs 规格型号, a.F_OkQty 合格数, a.F_NgQty 不良数, a.F_RequireAmount 需求数, b.F_UnitName 单位, CONVERT(NVARCHAR, CONVERT(DECIMAL(18,2), ROUND((F_OkQty+F_NgQty)*100 / IIF(ISNULL(F_RequireAmount,0)=0, 1, ISNULL(F_RequireAmount,0)), 2))) + '%' 生产进度, CASE WHEN a.F_Status=0 THEN '创建' WHEN a.F_Status=1 THEN '已排程' WHEN a.F_Status=2 THEN '已下发' WHEN a.F_Status=3 THEN '生产中' WHEN a.F_Status=4 THEN '已完成' WHEN a.F_Status=5 THEN '强制结单' ELSE '已取消' END 生产状态 FROM base_workorder a LEFT JOIN base_unit b ON a.F_Unit=b.F_Id LEFT JOIN base_part c ON a.F_partid=c.F_id WHERE a.F_CreatorTime>DATEDIFF(day, GETDATE(), -30) ORDER BY F_RequireTime DESC

[production.inspect_unfinished]
# name=点检未完成项
wrap=none
columns=F_EquipName:varchar(100),b:int
sql=SELECT F_EquipName, COUNT(1) b FROM eq_check_record WHERE F_Status=0 GROUP BY F_EquipName

[production.dept_daily_plan]
# name=各部门当日计划数
wrap=none
columns=dayss1:varchar(10),onoffrate:decimal(18,0)
sql=select name dayss1,value onoffrate from (select top 7 right(convert(nvarchar(10), F_CreatorTime,120),5) name, sum(case when F_Status=1 then 1 else 0 end)*100.0 /ISNULL(count(1),1) value from eq_check_record group by convert(nvarchar(10), F_CreatorTime,120) order by convert(nvarchar(10), F_CreatorTime,120) desc)aa order by aa.name

[production.plan_inbound_qty]
# name=计划入库量
wrap=none
columns=value:decimal(18,2)
sql=select avg( F_Efficienc) value from base_equip_runinfo where datediff(day,F_CreateTime,getdate())=0

[production.inspection_completion_rate]
# name=点检完成率
wrap=none
columns=value:decimal(18,2)
sql=select sum(case when F_Status=1 then 1 else 0 end)*100.0 /ISNULL(count(1),1) value from eq_check_record where datediff(mm,F_CreatorTime,getdate())=0

[production.repair_completion_rate]
# name=维修完成率
wrap=none
columns=value:decimal(18,2)
sql=select ISNULL(sum(case when F_Status=1 then 1 else 0 end)*100.0 /ISNULL(count(1),1),0) value from eq_repair_record where datediff(mm,F_CreatorTime,getdate())=0
